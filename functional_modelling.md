# **VSD RISC-V SoC Tapeout: Week 2 Progress**

This report documents the progress made during the second week of the RISC-V System-on-Chip (SoC) tapeout program, focusing on the Phase-Locked Loop (PLL), reset logic, and inter-module dataflow of the VSDBabySoC.

-----

## **SETUP & SIMULATION**

```bash
cd ~
sudo apt install make python python3 python3-pip git iverilog gtkwave docker.io
sudo chmod 666 /var/run/docker.sock
pip3 install pyyaml click sandpiper-saas
git clone https://github.com/manili/VSDBabySoC
cd VSDBabySoC/
make pre_synth_sim
gtkwave output/pre_synth_sim/pre_synth_sim.vcd
```

<img width="2734" height="1403" alt="image" src="https://github.com/user-attachments/assets/1772c2fb-bd27-42be-80fd-99d6bd8078e9" />

## **PLL (Phase-Locked Loop)** ‚öôÔ∏è

The PLL is responsible for generating a high-frequency internal clock from a slower, stable external reference clock.

The input reference clock, **`REF`**, is generated by an external crystal oscillator. From the waveform, its time period is observed to be approximately **280 ns**, which corresponds to a frequency of about **3.57 MHz** ($1 / 280ns$).

The behavioral Verilog model for the PLL is designed to produce an output clock, **`CLK`**, that is phase-aligned with `REF` but multiplied in frequency by a factor of 8, as shown in the code snippet:

```verilog
// Update period on every reference rising edge
always @(posedge REF) begin
  if (lastedge > 0.0) begin
    refpd = $realtime - lastedge;
    // The output period is set to 1/8th of the reference period
    period =  (refpd / 8.0) ;
  end
  lastedge = $realtime;
end
```
<img width="2417" height="294" alt="image" src="https://github.com/user-attachments/assets/159bf486-a842-4a1e-b840-7cd591191c54" />
As expected, the output clock `CLK` has a frequency of approximately **28.57 MHz** (8 \* 3.57 MHz), confirming the correct operation of the frequency multiplier.

**Caption:** *The output clock `CLK` (bottom) has a frequency 8 times higher than the input reference clock `REF` (top).*

-----

## **Reset Logic and DAC Output** üîÑ

The system's reset sequence ensures that the CPU core starts in a known, predictable state.

Initially, the **`reset`** signal is held high. Once the system stabilizes, it is pulled low after a few clock cycles. When `reset` is de-asserted, the CPU begins executing its program. The computational results are then sent to the Digital-to-Analog Converter (DAC).

The waveform shows that the DAC is fed with new, calculated values (`RV_TO_DAC[9:0]`) from the core shortly after the reset is released. The DAC's analog output (`OUT`) then changes accordingly.

<img width="2421" height="313" alt="image" src="https://github.com/user-attachments/assets/7d25d877-5f86-4965-acf9-55ca1f33443d" />

**Caption:** *After `reset` (top) goes low, the core's output to the DAC `RV_TO_DAC[9:0]` (middle) updates, causing a change in the analog `OUT` (bottom).*

-----

## **Dataflow Between Modules** ‚û°Ô∏è

This waveform provides a comprehensive view of the signal flow between the PLL, the CPU core (`rvmyth`), and the DAC.

**Caption:** *Signal trace from the reference clock input to the final analog output.*

<img width="2364" height="451" alt="image" src="https://github.com/user-attachments/assets/494f733b-32c2-4a79-987e-e895e21877df" />

The numbered signals correspond to the following data path:

1.  **`REF`**: The initial reference clock is sent to the SoC's internal PLL.
2.  **`CLK`**: The PLL outputs a clock signal that is 8 times the frequency of `REF`.
3.  **`CLK` (Core Input)**: This is the clock as received by the `rvmyth` CPU core, which drives its sequential logic.
4.  **`reset`**: The reset signal is delivered to the `rvmyth` core.
5.  **`CPU_pc_a0[31:0]`**: The Program Counter (PC) of the CPU. It is held at `0x00` while `reset` is high and begins incrementing to fetch instructions once `reset` is low.
6.  **`OUT[9:0]`**: The 10-bit digital output from the core, originating from register `r17`.
7.  **`D[9:0]`**: This is the same digital value as received by the DAC module at its input port `D`.
8.  **`OUT` (Analog)**: The final `real` (analog) voltage output produced by the DAC based on its digital input.
